# 21. 메시지 큐를 이용한 비동기 통신
- 메시지 큐를 이용해서 메시지를 주고 받는 방식이다.
- 첫번째 시나리오는 시스템 성능과 확장성을 개선하는 시나리오
- 두번째 시나리오는 무중단으로 새기능을 추가하는 시나리오다.
- REDIS, NATS
## 21.1 비동기 메시지란?
- 동기적 통신은 통화 가능해야하고 응답처리가 오래걸려 타임아웃이 된다.
- 비동기 통신은 서버에 요청할 것이 생기면, 서버에 직접 요청을 보내느 대신 큐에 요청을 보낸다.
- 서버는 큐를 주시하다가 메시지를 수신하고 처리한다.
- 단점: 큐의 신뢰성이 뛰어나야한다. 큐 기술 사용료가 비싸다. 개발, 테스트환경에서 큐를 테스트하기 쉽지 않다.
- 메시지큐의 퍼블리셔와 서브스크라이버 형태로 구현한다.

## 21.2 클라우드 네이티브 메시지 큐 사용하기
- 세가지 구성요소
  - 메시지 큐
  - 이벤트 발생시 메시지 발행 퍼블리셔
  - 메시지 수신할 서브스크라이버

## 21.3 메시지 수신과 처리
- 메시지 핸들러라고 한다.
- QUEUE로 비동기 처리 메시지는 한번에 하나씩 처리해서 SQL 연결도 컨테이너가 10개면 10개만 있으면된다.
- 결과적 일관성이라고 한다.
- UI에서 모든 메시지의 처리가 끝나고 할 일 목록이 갱신 됐음을 의미하는 이벤트를 기다렸다가 그에 맞춰 화면 리프레시하면됨
- 이러한 푸시 모델은 현재 사용된 풀리 모델에 비해 훨씬 효율적이다.
- 중요한것은 이렇게 코드 한줄 수정하지 않고 처리용량이 3배가 늘었다.

## 21.4 메시지 핸들러 기능 추가하기
- 이벤트 드리븐 아키텍쳐가 되엇다.
- 이벤트 처리 로직 변경으로 기능 변경이 가능하므로 구성 요소간 결합도를 느슨하게 한다.
- 새 기능을 추가하는 가장 쉬운 방법은 새로운 메시지 핸들러의 그룹을 만들고 모든 메시지를 수신하되 이벤트 처리를 다르게한다.
- 
## 21.5 비동기 메시징 패턴 이해하기
- 고급 주제이지만 도커를 이용해 진입 장벽이 굉장히 낮아진다.
- 퍼블리시 서브스크라이버 패턴은 누가 어떻게 처리하고 언제 처리가 끝나는지 모른다.
- 리퀘스트 리스폰스 패턴으로 응답을 기다리고 클라이언트에게 다시 전달 할 수도 있다.
- 보통 FIRE-AND-FORGET (응답을 기다리지 않음), SCATTER-GATHER 을 모두 지원할 수 있다.
