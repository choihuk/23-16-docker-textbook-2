---
marp: true
---
# 21장 메시지 큐를 이용한 비동기 통신
---
## 21.1 비동기 메시징이란?
* 비동기 통신은 클라이언트가 서버에 직접 요청을 보내는 대신 큐에 요청을 보낸다.
* 서버는 큐를 주시하다 메시지를 수신하고 처리. 이때 처리한 데이터를 큐로 보낸다. 클라이언트가 응답을 필요로 하는 상태라면 큐를 주시하며 서버가 보낸 메시지를 수신한다.
* 메시지 큐는 일반적으로 고도로 최적화된 전용 통신 프로토콜을 가지고 있다. 이 프로토콜에 따라 클라이언트는 메시지를 보낸 후 큐의 수신 확인을 기다린다.
* 메시지를 보내는 컴포넌트는 퍼블리셔(publisher)가 되고, 메시지를 받는 컴포넌트는 서브스크라이버(subscriber)가 된다. 다양한 시스템이 메시지 큐를 이용할 수 있으므로 채널(channel)을 나눠 메시지를 구분한다.

---
## 21.2 클라우드 네이티브 메시지 큐 사용하기
* 메세지 큐는 데이터베이스 서버의 커넥션 수보다 훨씬 많은 수의 퍼블리셔를 처리할 수 있고 필요한 접속의 지속 시간도 휠씬 짧아서 처리 한계에 도달하지 않는다.
* NATS는 CNCF 에서 관리하는 프로젝트로 메시지를 메모리에 저장한다.
---
## 21.3 메시지 수신 및 처리
* 메시지 핸들러 : 큐를 구독하는 컴포넌트
* 메시지의 종류마다 이를 처리하는 메시지 헨들러가 하나씩 필요하다.
* 메시지 큐는 급증하는 부하의 버퍼와도 같은 역할을 하기 때문에 스케일링이 용이하다.
---
## 21.4 메시지 헨들러로 기능 추가하기
* 이벤트 지향 아키텍처 : 애플리케이션이 모든 일을 즉각 동기적으로 처리하는 대신 이벤트를 통해 다른 구성 요소에 자신의 현재 상태를 알리는 방식
* 이벤트를 발행하는 로직을 변경하지 않고도 이벤트 처리 로직을 바꿀 수 있으므로 애플리케이션의 구성 요소 간 결합도를 느슨하게 하는 효과가 있다.
* 이벤트 처리를 다르게 하는 핸들러를 추가하는 것으로 기능을 간편하게 추가할 수 있기에 무중단 배포가 가능하며 기존 시스템에 영향을 주지 않는다.